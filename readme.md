# Passpoint Server
Serverside for agreements collector, based on Flask

## Текущий статус готовности сервера
 
| Фича | Описание | Когда нужна | Статус |
| --- | --- | --- | --- |
|Документация API | Без описания с API трудно работать | Чекпойнт | Готово
| add_note | Метод для добавления записи | Чекпойнт | Готово
| get_render | Метод для получения подписанного PDF | Финал | Заглушка
| return_post | Метод для получения одной записи по ID | Чекпойнт | Готово
| return_latest | Метод для получения последних n постов | Чекпойнт | Готово
| return_query| Метод для получения n записей по условиям поиска | Финал | Отсутсвует

Кроме того, требуется проработать механизм идентификации пользователей системы, но если она будет использоватся только из внутренней сети, то проблема вторична.


## Работа с API
Все методы API возвращают нормальный код HTTP.

Каждый метод режит в *ip:8080/api/имя*

### add_note
Метод для добавления новой записи в БД. Ожидаемый формат запроса:
```json
{
 "Place" : "Название ЦОДа",
 "IdDevice" : "MD5 MAC модуля",
  "person": {
    "firstName" : "Имя",
    "middleName" : "Отчество",
    "lastName" : "Фамилия",
    "signature" : "MD5 файла"
  }
}
```
В случае успешного добавления, ответ - HTTP 200

### get_render
Метод для получения подписанной PDF версии файла. Ожидаемый формат запроса:
```json
{
"Id" : "42"
}
```
Ожидаемый формат ответа - относительная ссылка на файл:
```json
{
"RenderedDocument" : "rendered_docs/42.pdf"
}
```


### return_post
Метод для получения одной записи по *ID*. Ожидаемый формат запроса:
```json
{
  "Id" : 42
}
```
Ожидаемый формат ответа - информация о одном посте:
```json
{
  "DeviceId" : "Устройство, с которого пост был отправлен",
  "Place" : "Имя ЦОД",
  "FirstName" : "Имя",
  "MiddleName" : "Отчество",
  "LastName" : "Фамилия",
  "Signature" : "b64 подписи",
  "SignedDate" : "2019-05-26 08:45:40.901427"
}
```


### return_latest
Метод для получения множества последних записей по *offset*. Ожидаемый формат запроса:
```json
{
  "offset" : "2"
}
```

Ожидаемый формат ответа - информация о *offset* последних постах. Если столько постов нет в БД, вернется меньше:
```json
[
 {
  "DeviceId" : "Устройство, с которого пост был отправлен",
  "Place" : "Имя ЦОД",
  "FirstName" : "Имя",
  "MiddleName" : "Отчество",
  "LastName" : "Фамилия",
  "Signature" : "b64 подписи",
  "SignedDate" : "2019-05-26 08:45:40.901426"
 },
 {
  "DeviceId" : "Устройство, с которого пост был отправлен",
  "Place" : "Имя ЦОД",
  "FirstName" : "Имя",
  "MiddleName" : "Отчество",
  "LastName" : "Фамилия",
  "Signature" : "b64 подписи",
  "SignedDate" : "2019-05-26 08:45:40.901427"
 }
]
```

### return_query
Возвращает последние *offset* постов, которые подходят по условиям. Если в БД меньше документов, список будет меньше.
 Если в БД нет таких записей, вернется пустой список.
  
  Допустимые условия:
- *DeviceId* - поиска документов с конкретного устройства
- *Place* - поиска документов из конкретного ЦОДа
- *FirstName* - поиска документов по имени
- *LastName* - поиска по фамилии
- *MiddleName* - поиска по отчесту
- *Older* - поиск всех документов старше UNIXTIME
- *Newer* - поиск всех документов младше UNIXTIME

Ожидаемый зпрос:
```json
{
 "offset": "2",
 "arguments": {
  "DeviceId" : "742cc9d3023fe0f831f57d6475976a2c",
  "LastName" : "Циндяйкин",
  "Newer" : "1558852546"
 }
}
```

Ожидаемый ответ:
```json
[
 {
  "DeviceId" : "742cc9d3023fe0f831f57d6475976a2c",
  "Place" : "Имя ЦОД",
  "FirstName" : "Имя",
  "MiddleName" : "Отчество",
  "LastName" : "Циндяйкин",
  "Signature" : "b64 подписи",
  "SignedDate" : "2019-05-26 08:45:40.901426"
 },
 {
  "DeviceId" : "742cc9d3023fe0f831f57d6475976a2c",
  "Place" : "Имя ЦОД",
  "FirstName" : "Имя",
  "MiddleName" : "Отчество",
  "LastName" : "Циндяйкин",
  "Signature" : "b64 подписи",
  "SignedDate" : "2019-05-26 08:45:40.901427"
 }
]
```